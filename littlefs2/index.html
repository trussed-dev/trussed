<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="littlefs is a filesystem for microcontrollers written in C, that claims to be fail-safe:"><meta name="keywords" content="rust, rustlang, rust-lang, littlefs2"><title>littlefs2 - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../littlefs2/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate littlefs2</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.3.2</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all littlefs2's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="littlefs2" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">littlefs2</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/littlefs2/lib.rs.html#1-165" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><a href="https://github.com/ARMmbed/littlefs">littlefs</a> is a filesystem for microcontrollers
written in C, that claims to be <em>fail-safe</em>:</p>
<ul>
<li>power-loss resilience, by virtue of copy-on-write guarantees</li>
<li>bounded RAM/ROM, with stack-allocated buffers</li>
</ul>
<p>Since <a href="https://github.com/ARMmbed/littlefs/releases/tag/v2.0.0">version 2</a>, it has
some nifty features such as:</p>
<ul>
<li>dynamic wear-leveling, including detection of bad Flash blocks</li>
<li>custom user attributes</li>
<li>inline files, avoiding block waste</li>
</ul>
<p>For more background, see its <a href="https://github.com/ARMmbed/littlefs/blob/master/DESIGN.md">design notes</a>
and the <a href="https://github.com/ARMmbed/littlefs/blob/master/SPEC.md">specification</a> of its format.</p>
<h3 id="what-is-this" class="section-header"><a href="#what-is-this">What is this?</a></h3>
<p>This library, <a href="https://lib.rs/littlefs2"><code>littlefs2</code></a>, offers an idiomatic Rust API for littlefs.</p>
<p>It follows the design of <a href="https://doc.rust-lang.org/std/fs/index.html"><code>std::fs</code></a> as much as reasonable,
and builds on the bindings <a href="https://lib.rs/littlefs2-sys"><code>littlefs2-sys</code></a>.</p>
<p>Some complications arise due to the lack of const generics in Rust, we work around these
with the <a href="https://lib.rs/generic-array"><code>generic-array</code></a> library, and long for the day when
constants associated to traits will be treated as constants by the compiler.</p>
<p>Another complication is the fact that files (and directories) need to be closed before they go out of scope,
since the main littlefs state structure contains a linked list which would exhibit UB (undefined behaviour)
otherwise, see <a href="https://github.com/nickray/littlefs2/issues/3">issue #3</a> and
<a href="https://github.com/nickray/littlefs2/issues/5">issue #5</a>. We choose <em>not</em> to call <code>close</code> in <code>drop</code> (as
<code>std::fs</code> does), since these operations could panic if for instance <code>littlefs</code> detects Flash corruption
(from which the application might otherwise recover).</p>
<p>For this reason, the various <code>File</code>-related <code>open</code> methods are marked as <code>unsafe</code>.
Instead, a closure-based API is offered (<code>open_and_then</code> and friends),
the same is done for <code>Filesystem::read_dir</code>. Under the hood, this API first calls the unsafe constructor,
then calls the user-supplied closure, and finally closes the object.</p>
<p><strong>FOLLOWING SECTION OUT-OF-DATE</strong></p>
<p>⯈ <a href="fs/index.html"><strong>The best place to start reading the API docs is here</strong></a>. ⯇</p>
<h3 id="usage" class="section-header"><a href="#usage">Usage</a></h3>
<p>To use this library, implement <code>littlefs2::driver::Storage</code>.
The macro <code>ram_storage!</code> generates examples of this.</p>
<p>Roughly speaking, the <a href="driver/trait.Storage.html"><code>Storage</code></a> trait defines a block device in
terms of actual and <code>typenum</code> constants, and an implementation supplies methods to read, erase and write.</p>
<p>The filesystem and each open file need memory for state and caching, this has to be allocated
beforehand and passed to constructors.</p>
<h3 id="no_std" class="section-header"><a href="#no_std"><code>no_std</code></a></h3>
<p>This library is <code>no_std</code> compatible, but there are two gotchas.</p>
<ul>
<li>
<p>The dev-dependency <code>memchr</code> of <code>littlefs2-sys</code> has its <code>std</code> features activated. To prevent this, upgrade to at least Rust 1.51
and add <code>resolver = &quot;2&quot;</code> in the consuming code’s <code>[package]</code> section. This will be the default in Rust 2021 edition.</p>
</li>
<li>
<p>At link time, <code>lfs.c</code> has a dependency on <code>strcpy</code>. When not linking to a <code>libc</code> with this symbol, activate the <code>c-stubs</code> feature
to provide an implementation.</p>
</li>
</ul>
<h3 id="design-notes" class="section-header"><a href="#design-notes">Design notes</a></h3>
<p>All operations on the filesystem require passing a <code>&amp;mut Storage</code>, which guarantees by Rust’s
borrow checker that only one thread can manipulate the filesystem.
This design choice (as opposed to consuming the Storage, which would be less verbose) was made to
enable use of the underlying flash peripheral outside of the filesystem (the <code>Storage</code> can be
dropped and reconstructed).  For instance, one could setup an additional filesystem,
or handle some flash data manually.</p>
<p>As an experiment, we implemented <a href="fs/struct.ReadDirWith.html"><code>ReadDirWith</code></a>. It converts a
<a href="fs/struct.ReadDir.html"><code>ReadDir</code></a> (which needs mutable references, and so is “not quite an iterator”
over the files of a directory), into a true iterator, by temporarily binding the mutable references.</p>
<p>Currying with lifetime gymnastics!</p>
<p>In the future, we may extend this approach to other operations, thus adding a secondary API layer.</p>
<p><a href="https://play.rust-lang.org/?edition=2018&amp;gist=c86abf99fc87551cfe3136e398a45d19">https://play.rust-lang.org/?edition=2018&amp;gist=c86abf99fc87551cfe3136e398a45d19</a></p>
<p>Separately, keeping track of the allocations is a chore, we hope that
<a href="https://doc.rust-lang.org/core/pin/index.html"><code>Pin</code></a> magic will help fix this.</p>
<h3 id="example" class="section-header"><a href="#example">Example</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// example storage backend</span>
<span class="macro">ram_storage!</span>(<span class="ident">tiny</span>);
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">ram</span> <span class="op">=</span> <span class="ident">Ram::default</span>();
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">storage</span> <span class="op">=</span> <span class="ident">RamStorage::new</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">ram</span>);

<span class="comment">// must format before first mount</span>
<span class="ident">Filesystem::format</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">storage</span>).<span class="ident">unwrap</span>();
<span class="comment">// must allocate state statically before use</span>
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">alloc</span> <span class="op">=</span> <span class="ident">Filesystem::allocate</span>();
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">fs</span> <span class="op">=</span> <span class="ident">Filesystem::mount</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">alloc</span>, <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">storage</span>).<span class="ident">unwrap</span>();

<span class="comment">// may use common `OpenOptions`</span>
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">buf</span> <span class="op">=</span> [<span class="number">0u8</span>; <span class="number">11</span>];
<span class="ident">fs</span>.<span class="ident">open_file_with_options_and_then</span>(
    <span class="op">|</span><span class="ident">options</span><span class="op">|</span> <span class="ident">options</span>.<span class="ident">read</span>(<span class="bool-val">true</span>).<span class="ident">write</span>(<span class="bool-val">true</span>).<span class="ident">create</span>(<span class="bool-val">true</span>),
    <span class="kw-2">&amp;</span><span class="ident">PathBuf::from</span>(<span class="string">b&quot;example.txt&quot;</span>),
    <span class="op">|</span><span class="ident">file</span><span class="op">|</span> {
        <span class="ident">file</span>.<span class="ident">write</span>(<span class="string">b&quot;Why is black smoke coming out?!&quot;</span>)<span class="question-mark">?</span>;
        <span class="ident">file</span>.<span class="ident">seek</span>(<span class="ident">SeekFrom::End</span>(<span class="op">-</span><span class="number">24</span>)).<span class="ident">unwrap</span>();
        <span class="macro">assert_eq!</span>(<span class="ident">file</span>.<span class="ident">read</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>)<span class="question-mark">?</span>, <span class="number">11</span>);
        <span class="prelude-val">Ok</span>(())
    }
).<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="kw-2">&amp;</span><span class="ident">buf</span>, <span class="string">b&quot;black smoke&quot;</span>);</code></pre></div>
</div></details><h2 id="reexports" class="section-header"><a href="#reexports">Re-exports</a></h2>
<div class="item-table"><div class="item-left import-item"><code>pub use <a class="mod" href="../littlefs2_sys/index.html" title="mod littlefs2_sys">littlefs2_sys</a> as ll;</code></div><div class="item-right docblock-short"></div></div><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="mod" href="consts/index.html" title="littlefs2::consts mod">consts</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="mod" href="driver/index.html" title="littlefs2::driver mod">driver</a></div><div class="item-right docblock-short"><p>The <code>Storage</code>, <code>Read</code>, <code>Write</code> and <code>Seek</code> driver.</p>
</div><div class="item-left module-item"><a class="mod" href="fs/index.html" title="littlefs2::fs mod">fs</a></div><div class="item-right docblock-short"><p>Experimental Filesystem version using closures.</p>
</div><div class="item-left module-item"><a class="mod" href="io/index.html" title="littlefs2::io mod">io</a></div><div class="item-right docblock-short"><p>Traits and types for core I/O functionality.</p>
</div><div class="item-left module-item"><a class="mod" href="macros/index.html" title="littlefs2::macros mod">macros</a></div><div class="item-right docblock-short"><p>cf. Macros documentation</p>
</div><div class="item-left module-item"><a class="mod" href="path/index.html" title="littlefs2::path mod">path</a></div><div class="item-right docblock-short"><p>Paths</p>
</div></div><h2 id="macros" class="section-header"><a href="#macros">Macros</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="macro" href="macro.const_ram_storage.html" title="littlefs2::const_ram_storage macro">const_ram_storage</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="macro" href="macro.debug.html" title="littlefs2::debug macro">debug</a></div><div class="item-right docblock-short"><p>Local version of <code>debug!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.debug_now.html" title="littlefs2::debug_now macro">debug_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>debug!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.error.html" title="littlefs2::error macro">error</a></div><div class="item-right docblock-short"><p>Local version of <code>error!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.error_now.html" title="littlefs2::error_now macro">error_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>error!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.info.html" title="littlefs2::info macro">info</a></div><div class="item-right docblock-short"><p>Local version of <code>info!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.info_now.html" title="littlefs2::info_now macro">info_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>info!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.log.html" title="littlefs2::log macro">log</a></div><div class="item-right docblock-short"><p>Local version of <code>log!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.log_now.html" title="littlefs2::log_now macro">log_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>log!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.ram_storage.html" title="littlefs2::ram_storage macro">ram_storage</a></div><div class="item-right docblock-short"><p>A configurable implementation of the Storage trait in memory.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.trace.html" title="littlefs2::trace macro">trace</a></div><div class="item-right docblock-short"><p>Local version of <code>trace!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.trace_now.html" title="littlefs2::trace_now macro">trace_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>trace!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_debug.html" title="littlefs2::try_debug macro">try_debug</a></div><div class="item-right docblock-short"><p>Fallible version of <code>debug!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_debug_now.html" title="littlefs2::try_debug_now macro">try_debug_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>debug!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_error.html" title="littlefs2::try_error macro">try_error</a></div><div class="item-right docblock-short"><p>Fallible version of <code>error!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_error_now.html" title="littlefs2::try_error_now macro">try_error_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>error!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_info.html" title="littlefs2::try_info macro">try_info</a></div><div class="item-right docblock-short"><p>Fallible version of <code>info!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_info_now.html" title="littlefs2::try_info_now macro">try_info_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>info!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_log_now.html" title="littlefs2::try_log_now macro">try_log_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>log!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_trace.html" title="littlefs2::try_trace macro">try_trace</a></div><div class="item-right docblock-short"><p>Fallible version of <code>trace!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_trace_now.html" title="littlefs2::try_trace_now macro">try_trace_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>trace!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_warn.html" title="littlefs2::try_warn macro">try_warn</a></div><div class="item-right docblock-short"><p>Fallible version of <code>warn!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.try_warn_now.html" title="littlefs2::try_warn_now macro">try_warn_now</a></div><div class="item-right docblock-short"><p>Fallible immediate version of <code>warn!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.warn.html" title="littlefs2::warn macro">warn</a></div><div class="item-right docblock-short"><p>Local version of <code>warn!</code>.</p>
</div><div class="item-left module-item"><a class="macro" href="macro.warn_now.html" title="littlefs2::warn_now macro">warn_now</a></div><div class="item-right docblock-short"><p>Immediate version of <code>warn!</code>.</p>
</div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="struct" href="struct.Version.html" title="littlefs2::Version struct">Version</a></div><div class="item-right docblock-short"><p>Information about the C backend</p>
</div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="fn" href="fn.version.html" title="littlefs2::version fn">version</a></div><div class="item-right docblock-short"><p>get information about the C backend</p>
</div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="littlefs2" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>