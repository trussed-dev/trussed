<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Compile-time configurable deferred logging (for `printf()`-debugging aka tracing)"><title>delog - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="delog" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0 (79e9716c9 2023-11-13)" data-channel="1.74.0" data-search-js="search-8be46b629f5f14a8.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../delog/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a></nav><nav class="sidebar"><a class="logo-container" href="../delog/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate delog</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.1.7</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">delog</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/delog/lib.rs.html#1-185">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="compile-time-configurable-deferred-logging-for-printf-debugging-aka-tracing"><a href="#compile-time-configurable-deferred-logging-for-printf-debugging-aka-tracing">Compile-time configurable deferred logging (for <code>printf()</code>-debugging <em>aka</em> tracing)</a></h2>
<p>This is an implementation of the <code>log::Log</code> trait, suitable for use
in both embedded and desktop environments.</p>
<p>It has two main goals:</p>
<ul>
<li>logs are stored in a circular static memory buffer, so that logging is “zero-cost in the inner
loop” (apart from the formatting), with deferred actual I/O later via flushing.</li>
<li>compile-time log level settings for applications with multiple library components;
inactive log levels of libraries are completely compiled out.</li>
</ul>
<p>Moreover, setting the kill switch feature flag <code>knock-it-off</code>, any and all traces of logging
are removed from the final binary.</p>
<h3 id="usage-and-defaults"><a href="#usage-and-defaults">Usage and defaults</a></h3>
<blockquote>
<p><em>“Global settings subtractive (default all), local settings additive (default none) but with kill-switch.”</em></p>
</blockquote>
<p>From <code>log</code>, we inherit:</p>
<ul>
<li>static global filters, default <code>LevelFilter::Trace</code> (i.e., everything), set via <code>delog</code> or
<code>log</code> feature flags (multiple settings result in the most restrictive filter)</li>
<li>dynamic global filter, initialized in the “init”/“init_default” constructors of the
macro-generated structs implementing our <code>Delogger</code> trait. This can be changed by calls to
the global <code>set_max_level</code> function in <code>log</code>.</li>
</ul>
<p>Libraries that use the logging macros from <code>log</code> are governed by the more restrictive of these two settings.</p>
<p>On the other hand, a library that uses the <code>delog::generate_macros!()</code> macro gains macros <code>info!</code>, <code>warn!</code>, etc.,
which, by default, do nothing, and are completely optimized out.</p>
<p>If such a libray itself defines a feature <code>log-all</code> that is active, then logging calls with these macros are passed through
and goverend by the global filters. Such a library can also define a feature such as
<code>log-info</code>, which activates <em>exactly</em> the info-level logs; it is up to the library to define
logic such as “log-info implies log-warn”. There is a kill-switch: if the library defines a
feature <code>log-none</code>, and some intermediate library activates one of the additive <code>log-*</code>
features, setting <code>log-none</code> completely turns off logging for this library.</p>
<h3 id="background"><a href="#background">Background</a></h3>
<p>Compared to existing approaches such as <code>ufmt</code>, <code>cortex-m-funnel</code> and <code>defmt</code>,
we pursue different values and requirements, namely:</p>
<ul>
<li><strong>compatibility with the standard <code>core::fmt</code> traits and the standard <code>log</code> library API</strong>.
This means that, while libraries may “upgrade” their logging capabilities by using <code>delog</code>
as drop-in replacement for their logging calls (see below), any existing library that already
uses <code>log</code> is compatible. This, for our use cases, is a huge win, as opposed to using up “weirdness
budget” and requiring custom tooling for something that is often trivial, throw-away, simple logging.</li>
<li>it follows that one can easily drop a <code>trace!(&quot;{:?}&quot;, &amp;suspicious_object)</code> call at any time for
any object that has a (possibly automatically derived) <code>Debug</code> trait implementation – without
passing around structures and keeping on top of lifetimes.</li>
<li>deferred logging: This is a typical “shared memory” logger, calls to <code>info!</code> etc.
are not directly sent to their final output, but instead are stored in a circular buffer
that is “drained” by calling <code>flush</code> on the logger at a convenient moment, for instance
in an idle loop.</li>
<li>immediate mode logging: Sometimes one wants to bypass the deferred flushing of logs,
this is possible using either the little-known <code>target</code> argument to <code>info!</code> and friends
with “!” as parameter, or using the additional <code>immediate_info!</code> and friends macros.</li>
<li>ability to set log levels <em>per library, at compile-time</em>. This can be easily retro-fitted
on existing <code>log</code>-based libraries, by adding the requisite features in <code>Cargo.toml</code> and
replacing <code>log</code> with <code>delog</code> (see <code>gate-tests</code> for examples of this).</li>
<li>the outcome is that one can leave useful logging calls in the library code, only to activate
them in targeted ways at build time, exactly as needed.</li>
<li>helper macros to easily output binary byte arrays and slices in hexadecimal representations,
which wrap the data in newtypes with custom <code>fmt::UpperHex</code> etc. implementations.</li>
</ul>
<p><strong>Non-goals</strong>:</p>
<ul>
<li>ultimate speed or code size: Our intention are “normal” logs, not the use of logging/tracing to
for stream binary data to the host. While admittedly the <code>core::fmt</code>-ing facilities are not as
efficient as one might hope, in our use cases we have sufficient flash and RAM to use these (and
some hope that, someday, eventually, maybe, the formatting machinery will be revisited and
improved at the root level, namely the language itself.)</li>
</ul>
<p>That said, we believe there is opportunity to extend <code>delog</code> in the <code>defmt</code> direction by
using, e.g., the <code>fmt::Binary</code> trait, newtypes and sentinel values to embed raw binary
representations of data in time-critical situations without formatting, deferring
the extraction and actual formatting to some host-side mechanism.</p>
<h3 id="features"><a href="#features">Features</a></h3>
<p>The <code>flushers</code> and <code>semihosting</code> features mostly exist to share code within the examples,
including the <code>example</code> feature. Without them, dependencies are quite minimal, and compilation fast.</p>
<p>The <code>fallible</code> and <code>immediate</code> features (default on) activate the <code>try_*!</code> and <code>*_now!</code> macros, respectively.</p>
<h3 id="warning"><a href="#warning">Warning</a></h3>
<p>The current circular buffer implementation (v0.1.0) is definitely unsound on desktop.
For embedded use, atomics are required (so no Cortex-M0/M1, and no plans to support non-atomic
platforms, which are likely to also be too resource-constrained to support the bloat inherent
in <code>core::fmt</code>). While we think the implemented circular buffer algorithm works for the “nested interrupt”
setup of NVICs, it has not been tested much.
The hope is that the worst case scenario is some slightly messed up log outputs.</p>
<h3 id="outlook"><a href="#outlook">Outlook</a></h3>
<p>We plan to iterate towards a v0.2.0 soon, making use of a separate “flusher” for the
“immediate” logging path. For instance, when logging via serial-over-USB, one might want immediate
logs to pend a separate RTIC interrupt handler that blocks until the logs are pushed and read
(allowing one to debug the boot process of a firmware), or one might want to just write to RTT
(or even semihosting xD) for these, during development.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.log"><code>pub use <a class="mod" href="../log/index.html" title="mod log">log</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="hex/index.html" title="mod delog::hex">hex</a></div><div class="desc docblock-short">Convenient <code>Display</code> and other traits for binary data.</div></li><li><div class="item-name"><a class="mod" href="render/index.html" title="mod delog::render">render</a></div><div class="desc docblock-short">The default, minimal renderer, and some helper functions.</div></li></ul><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.delog.html" title="macro delog::delog">delog</a></div><div class="desc docblock-short">Generate a deferred logger with specified capacity and flushing mechanism.</div></li><li><div class="item-name"><a class="macro" href="macro.generate_macros.html" title="macro delog::generate_macros">generate_macros</a></div><div class="desc docblock-short">Generate logging macros that can be gated by library.</div></li><li><div class="item-name"><a class="macro" href="macro.hex_str.html" title="macro delog::hex_str">hex_str</a></div><div class="desc docblock-short">Compactly format byte arrays and slices as hexadecimals.</div></li><li><div class="item-name"><a class="macro" href="macro.hexstr.html" title="macro delog::hexstr">hexstr</a></div><div class="desc docblock-short">More compactly format byte arrays and slices as hexadecimals.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Record.html" title="struct delog::Record">Record</a></div><div class="desc docblock-short">The “payload” of a log message.</div></li><li><div class="item-name"><a class="struct" href="struct.Statistics.html" title="struct delog::Statistics">Statistics</a></div><div class="desc docblock-short">Statistics on logger usage.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Level.html" title="enum delog::Level">Level</a></div><div class="desc docblock-short">An enum representing the available verbosity levels of the logger.</div></li><li><div class="item-name"><a class="enum" href="enum.LevelFilter.html" title="enum delog::LevelFilter">LevelFilter</a></div><div class="desc docblock-short">An enum representing the available verbosity level filters of the logger.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Delogger.html" title="trait delog::Delogger">Delogger</a></div><div class="desc docblock-short">Semi-abstract characterization of the deferred loggers that the <code>delog!</code> macro produces.</div></li><li><div class="item-name"><a class="trait" href="trait.Flusher.html" title="trait delog::Flusher">Flusher</a></div><div class="desc docblock-short">A way to pass on logs, user supplied.</div></li><li><div class="item-name"><a class="trait" href="trait.Renderer.html" title="trait delog::Renderer">Renderer</a></div><div class="desc docblock-short">A way to format logs, user supplied.</div></li><li><div class="item-name"><a class="trait" href="trait.State.html" title="trait delog::State">State</a></div><div class="desc docblock-short">Trait for either state or statistics of loggers.</div></li><li><div class="item-name"><a class="trait" href="trait.TryLog.html" title="trait delog::TryLog">TryLog</a></div><div class="desc docblock-short">Fallible, panic-free version of the <code>log::Log</code> trait.</div></li><li><div class="item-name"><a class="trait" href="trait.TryLogWithStatistics.html" title="trait delog::TryLogWithStatistics">TryLogWithStatistics</a></div><div class="desc docblock-short">TryLog with some usage statistics on top.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.dequeue.html" title="fn delog::dequeue">dequeue</a><sup title="unsafe function">⚠</sup></div><div class="desc docblock-short">The core “read from circular buffer” method. Marked unsafe to discourage use!</div></li><li><div class="item-name"><a class="fn" href="fn.enqueue.html" title="fn delog::enqueue">enqueue</a><sup title="unsafe function">⚠</sup></div><div class="desc docblock-short">The core “write to circular buffer” method. Marked unsafe to discourage use!</div></li><li><div class="item-name"><a class="fn" href="fn.logger.html" title="fn delog::logger">logger</a></div><div class="desc docblock-short">Returns a reference to the logger (as <code>TryLogWithStatistics</code> implementation)</div></li><li><div class="item-name"><a class="fn" href="fn.try_enqueue.html" title="fn delog::try_enqueue">try_enqueue</a><sup title="unsafe function">⚠</sup></div><div class="desc docblock-short">The fallible “write to circular buffer” method. Marked unsafe to discourage use!</div></li></ul></section></div></main></body></html>