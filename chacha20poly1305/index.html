<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="[`ChaCha20Poly1305`] (RFC 8439) is an Authenticated Encryption with Associated Data (AEAD) cipher amenable to fast, constant-time implementations in software, based on the ChaCha20 stream cipher and Poly1305 universal hash function."><meta name="keywords" content="rust, rustlang, rust-lang, chacha20poly1305"><title>chacha20poly1305 - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/RustCrypto/meta/master/logo.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../chacha20poly1305/index.html"><div class="logo-container"><img src="https://raw.githubusercontent.com/RustCrypto/meta/master/logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../chacha20poly1305/index.html"><div class="logo-container">
                    <img src="https://raw.githubusercontent.com/RustCrypto/meta/master/logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate chacha20poly1305</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.8.2</li><li><a id="all-types" href="all.html">All Items</a></li></div></ul><section><div class="block"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#structs">Structs</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="chacha20poly1305" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../chacha20poly1305/index.html">
                        <img src="https://raw.githubusercontent.com/RustCrypto/meta/master/logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">chacha20poly1305</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/chacha20poly1305/lib.rs.html#1-325">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><a href="type.ChaCha20Poly1305.html" title="ChaCha20Poly1305"><code>ChaCha20Poly1305</code></a> (<a href="https://tools.ietf.org/html/rfc8439">RFC 8439</a>) is an
<a href="https://en.wikipedia.org/wiki/Authenticated_encryption">Authenticated Encryption with Associated Data (AEAD)</a>
cipher amenable to fast, constant-time implementations in software, based on
the <a href="https://github.com/RustCrypto/stream-ciphers/tree/master/chacha20">ChaCha20</a> stream cipher and <a href="https://github.com/RustCrypto/universal-hashes/tree/master/poly1305">Poly1305</a> universal hash function.</p>
<p>This crate contains pure Rust implementations of <a href="type.ChaCha20Poly1305.html" title="ChaCha20Poly1305"><code>ChaCha20Poly1305</code></a>
(with optional AVX2 acceleration) as well as the following variants thereof:</p>
<ul>
<li><a href="type.XChaCha20Poly1305.html" title="XChaCha20Poly1305"><code>XChaCha20Poly1305</code></a> - ChaCha20Poly1305 variant with an extended 192-bit (24-byte) nonce.</li>
<li><a href="type.ChaCha8Poly1305.html" title="ChaCha8Poly1305"><code>ChaCha8Poly1305</code></a> / <a href="type.ChaCha12Poly1305.html" title="ChaCha12Poly1305"><code>ChaCha12Poly1305</code></a> - non-standard, reduced-round variants
(gated under the <code>reduced-round</code> Cargo feature). See the <a href="https://eprint.iacr.org/2019/1492.pdf">Too Much Crypto</a>
paper for background and rationale on when these constructions could be used.
When in doubt, prefer <a href="type.ChaCha20Poly1305.html" title="ChaCha20Poly1305"><code>ChaCha20Poly1305</code></a>.</li>
<li><a href="type.XChaCha8Poly1305.html" title="XChaCha8Poly1305"><code>XChaCha8Poly1305</code></a> / <a href="type.XChaCha12Poly1305.html" title="XChaCha12Poly1305"><code>XChaCha12Poly1305</code></a> - same as above,
but with an extended 192-bit (24-byte) nonce.</li>
</ul>
<h3 id="security-notes"><a href="#security-notes">Security Notes</a></h3>
<p>This crate has received one <a href="https://research.nccgroup.com/2020/02/26/public-report-rustcrypto-aes-gcm-and-chacha20poly1305-implementation-review/">security audit by NCC Group</a>, with no significant
findings. We would like to thank <a href="https://www.mobilecoin.com/">MobileCoin</a> for funding the audit.</p>
<p>All implementations contained in the crate are designed to execute in
constant time, either by relying on hardware intrinsics (i.e. AVX2 on
x86/x86_64), or using a portable implementation which is only constant time
on processors which implement constant-time multiplication.</p>
<p>It is not suitable for use on processors with a variable-time multiplication
operation (e.g. short circuit on multiply-by-zero / multiply-by-one, such as
certain 32-bit PowerPC CPUs and some non-ARM microcontrollers).</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">chacha20poly1305</span>::{<span class="ident">ChaCha20Poly1305</span>, <span class="ident">Key</span>, <span class="ident">Nonce</span>}; <span class="comment">// Or `XChaCha20Poly1305`</span>
<span class="kw">use</span> <span class="ident">chacha20poly1305::aead</span>::{<span class="ident">Aead</span>, <span class="ident">NewAead</span>};

<span class="kw">let</span> <span class="ident">key</span> <span class="op">=</span> <span class="ident">Key::from_slice</span>(<span class="string">b&quot;an example very very secret key.&quot;</span>); <span class="comment">// 32-bytes</span>
<span class="kw">let</span> <span class="ident">cipher</span> <span class="op">=</span> <span class="ident">ChaCha20Poly1305::new</span>(<span class="ident">key</span>);

<span class="kw">let</span> <span class="ident">nonce</span> <span class="op">=</span> <span class="ident">Nonce::from_slice</span>(<span class="string">b&quot;unique nonce&quot;</span>); <span class="comment">// 12-bytes; unique per message</span>

<span class="kw">let</span> <span class="ident">ciphertext</span> <span class="op">=</span> <span class="ident">cipher</span>.<span class="ident">encrypt</span>(<span class="ident">nonce</span>, <span class="string">b&quot;plaintext message&quot;</span>.<span class="ident">as_ref</span>())
    .<span class="ident">expect</span>(<span class="string">&quot;encryption failure!&quot;</span>);  <span class="comment">// NOTE: handle this error to avoid panics!</span>
<span class="kw">let</span> <span class="ident">plaintext</span> <span class="op">=</span> <span class="ident">cipher</span>.<span class="ident">decrypt</span>(<span class="ident">nonce</span>, <span class="ident">ciphertext</span>.<span class="ident">as_ref</span>())
    .<span class="ident">expect</span>(<span class="string">&quot;decryption failure!&quot;</span>);  <span class="comment">// NOTE: handle this error to avoid panics!</span>

<span class="macro">assert_eq!</span>(<span class="kw-2">&amp;</span><span class="ident">plaintext</span>, <span class="string">b&quot;plaintext message&quot;</span>);</code></pre></div>
<h3 id="in-place-usage-eliminates-alloc-requirement"><a href="#in-place-usage-eliminates-alloc-requirement">In-place Usage (eliminates <code>alloc</code> requirement)</a></h3>
<p>This crate has an optional <code>alloc</code> feature which can be disabled in e.g.
microcontroller environments that don’t have a heap.</p>
<p>The <a href="../aead/trait.AeadInPlace.html#method.encrypt_in_place" title="AeadInPlace::encrypt_in_place"><code>AeadInPlace::encrypt_in_place</code></a> and <a href="../aead/trait.AeadInPlace.html#method.decrypt_in_place" title="AeadInPlace::decrypt_in_place"><code>AeadInPlace::decrypt_in_place</code></a>
methods accept any type that impls the <a href="../aead/trait.Buffer.html" title="aead::Buffer"><code>aead::Buffer</code></a> trait which
contains the plaintext for encryption or ciphertext for decryption.</p>
<p>Note that if you enable the <code>heapless</code> feature of this crate,
you will receive an impl of <a href="../aead/trait.Buffer.html" title="aead::Buffer"><code>aead::Buffer</code></a> for <code>heapless::Vec</code>
(re-exported from the <a href="../aead/index.html" title="aead"><code>aead</code></a> crate as <a href="../heapless/vec/struct.Vec.html" title="aead::heapless::Vec"><code>aead::heapless::Vec</code></a>),
which can then be passed as the <code>buffer</code> parameter to the in-place encrypt
and decrypt methods:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">chacha20poly1305</span>::{<span class="ident">ChaCha20Poly1305</span>, <span class="ident">Key</span>, <span class="ident">Nonce</span>}; <span class="comment">// Or `XChaCha20Poly1305`</span>
<span class="kw">use</span> <span class="ident">chacha20poly1305::aead</span>::{<span class="ident">AeadInPlace</span>, <span class="ident">NewAead</span>};
<span class="kw">use</span> <span class="ident">chacha20poly1305::aead::heapless::Vec</span>;

<span class="kw">let</span> <span class="ident">key</span> <span class="op">=</span> <span class="ident">Key::from_slice</span>(<span class="string">b&quot;an example very very secret key.&quot;</span>);
<span class="kw">let</span> <span class="ident">cipher</span> <span class="op">=</span> <span class="ident">ChaCha20Poly1305::new</span>(<span class="ident">key</span>);

<span class="kw">let</span> <span class="ident">nonce</span> <span class="op">=</span> <span class="ident">Nonce::from_slice</span>(<span class="string">b&quot;unique nonce&quot;</span>); <span class="comment">// 128-bits; unique per message</span>

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">buffer</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u8</span>, <span class="number">128</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">Vec::new</span>();
<span class="ident">buffer</span>.<span class="ident">extend_from_slice</span>(<span class="string">b&quot;plaintext message&quot;</span>);

<span class="comment">// Encrypt `buffer` in-place, replacing the plaintext contents with ciphertext</span>
<span class="ident">cipher</span>.<span class="ident">encrypt_in_place</span>(<span class="ident">nonce</span>, <span class="string">b&quot;&quot;</span>, <span class="kw-2">&amp;mut</span> <span class="ident">buffer</span>).<span class="ident">expect</span>(<span class="string">&quot;encryption failure!&quot;</span>);

<span class="comment">// `buffer` now contains the message ciphertext</span>
<span class="macro">assert_ne!</span>(<span class="kw-2">&amp;</span><span class="ident">buffer</span>, <span class="string">b&quot;plaintext message&quot;</span>);

<span class="comment">// Decrypt `buffer` in-place, replacing its ciphertext context with the original plaintext</span>
<span class="ident">cipher</span>.<span class="ident">decrypt_in_place</span>(<span class="ident">nonce</span>, <span class="string">b&quot;&quot;</span>, <span class="kw-2">&amp;mut</span> <span class="ident">buffer</span>).<span class="ident">expect</span>(<span class="string">&quot;decryption failure!&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="kw-2">&amp;</span><span class="ident">buffer</span>, <span class="string">b&quot;plaintext message&quot;</span>);</code></pre></div>
<h3 id="xchacha20poly1305"><a href="#xchacha20poly1305"><code>XChaCha20Poly1305</code></a></h3>
<p>ChaCha20Poly1305 variant with an extended 192-bit (24-byte) nonce.</p>
<p>The <code>xchacha20</code> Cargo feature must be enabled in order to use this
(which it is by default).</p>
<p>The construction is an adaptation of the same techniques used by
XSalsa20 as described in the paper “Extending the Salsa20 Nonce”
to the 96-bit nonce variant of ChaCha20, which derive a
separate subkey/nonce for each extended nonce:</p>
<p><a href="https://cr.yp.to/snuffle/xsalsa-20081128.pdf">https://cr.yp.to/snuffle/xsalsa-20081128.pdf</a></p>
<p>No authoritative specification exists for XChaCha20Poly1305, however the
construction has “rough consensus and running code” in the form of
several interoperable libraries and protocols (e.g. libsodium, WireGuard)
and is documented in an (expired) IETF draft, which also applies the
proof from the XSalsa20 paper to the construction in order to demonstrate
that XChaCha20 is secure if ChaCha20 is secure (see Section 3.1):</p>
<p><a href="https://tools.ietf.org/html/draft-arciszewski-xchacha-03">https://tools.ietf.org/html/draft-arciszewski-xchacha-03</a></p>
<p>It is worth noting that NaCl/libsodium’s default “secretbox” algorithm is
XSalsa20Poly1305, not XChaCha20Poly1305, and thus not compatible with
this library. If you are interested in that construction, please see the
<code>xsalsa20poly1305</code> crate:</p>
<p><a href="https://docs.rs/xsalsa20poly1305/">https://docs.rs/xsalsa20poly1305/</a></p>
<h2 id="usage-1"><a href="#usage-1">Usage</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">chacha20poly1305</span>::{<span class="ident">XChaCha20Poly1305</span>, <span class="ident">Key</span>, <span class="ident">XNonce</span>};
<span class="kw">use</span> <span class="ident">chacha20poly1305::aead</span>::{<span class="ident">Aead</span>, <span class="ident">NewAead</span>};

<span class="kw">let</span> <span class="ident">key</span> <span class="op">=</span> <span class="ident">Key::from_slice</span>(<span class="string">b&quot;an example very very secret key.&quot;</span>); <span class="comment">// 32-bytes</span>
<span class="kw">let</span> <span class="ident">aead</span> <span class="op">=</span> <span class="ident">XChaCha20Poly1305::new</span>(<span class="ident">key</span>);

<span class="kw">let</span> <span class="ident">nonce</span> <span class="op">=</span> <span class="ident">XNonce::from_slice</span>(<span class="string">b&quot;extra long unique nonce!&quot;</span>); <span class="comment">// 24-bytes; unique</span>
<span class="kw">let</span> <span class="ident">ciphertext</span> <span class="op">=</span> <span class="ident">aead</span>.<span class="ident">encrypt</span>(<span class="ident">nonce</span>, <span class="string">b&quot;plaintext message&quot;</span>.<span class="ident">as_ref</span>()).<span class="ident">expect</span>(<span class="string">&quot;encryption failure!&quot;</span>);
<span class="kw">let</span> <span class="ident">plaintext</span> <span class="op">=</span> <span class="ident">aead</span>.<span class="ident">decrypt</span>(<span class="ident">nonce</span>, <span class="ident">ciphertext</span>.<span class="ident">as_ref</span>()).<span class="ident">expect</span>(<span class="string">&quot;decryption failure!&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="kw-2">&amp;</span><span class="ident">plaintext</span>, <span class="string">b&quot;plaintext message&quot;</span>);</code></pre></div>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.aead"><code>pub use <a class="mod" href="../aead/index.html" title="mod aead">aead</a>;</code></div><div class="item-right docblock-short"></div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ChaChaPoly1305.html" title="chacha20poly1305::ChaChaPoly1305 struct">ChaChaPoly1305</a></div><div class="item-right docblock-short"><p>Generic ChaCha+Poly1305 Authenticated Encryption with Additional Data (AEAD) construction.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ChaCha8Poly1305.html" title="chacha20poly1305::ChaCha8Poly1305 type">ChaCha8Poly1305</a></div><div class="item-right docblock-short"><p>ChaCha8Poly1305 (reduced round variant) Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ChaCha12Poly1305.html" title="chacha20poly1305::ChaCha12Poly1305 type">ChaCha12Poly1305</a></div><div class="item-right docblock-short"><p>ChaCha12Poly1305 (reduced round variant) Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ChaCha20Poly1305.html" title="chacha20poly1305::ChaCha20Poly1305 type">ChaCha20Poly1305</a></div><div class="item-right docblock-short"><p>ChaCha20Poly1305 Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Key.html" title="chacha20poly1305::Key type">Key</a></div><div class="item-right docblock-short"><p>Key type (256-bits/32-bytes).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Nonce.html" title="chacha20poly1305::Nonce type">Nonce</a></div><div class="item-right docblock-short"><p>Nonce type (96-bits/12-bytes).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Tag.html" title="chacha20poly1305::Tag type">Tag</a></div><div class="item-right docblock-short"><p>Poly1305 tag.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.XChaCha8Poly1305.html" title="chacha20poly1305::XChaCha8Poly1305 type">XChaCha8Poly1305</a></div><div class="item-right docblock-short"><p>XChaCha8Poly1305 (reduced round variant) Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.XChaCha12Poly1305.html" title="chacha20poly1305::XChaCha12Poly1305 type">XChaCha12Poly1305</a></div><div class="item-right docblock-short"><p>XChaCha12Poly1305 (reduced round variant) Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.XChaCha20Poly1305.html" title="chacha20poly1305::XChaCha20Poly1305 type">XChaCha20Poly1305</a></div><div class="item-right docblock-short"><p>XChaCha20Poly1305 Authenticated Encryption with Additional Data (AEAD).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.XNonce.html" title="chacha20poly1305::XNonce type">XNonce</a></div><div class="item-right docblock-short"><p>XNonce type (192-bits/24-bytes).</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="chacha20poly1305" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0 (a8314ef7d 2022-06-27)" ></div>
</body></html>